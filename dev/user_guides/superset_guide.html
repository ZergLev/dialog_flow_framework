<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Superset guide &#8212; Python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimization Guide" href="optimization_guide.html" />
    <link rel="prev" title="Context guide" href="context_guide.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="superset-guide">
<h1>Superset guide<a class="headerlink" href="#superset-guide" title="Permalink to this heading">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">The Dialog Flow Stats module can be used to obtain and visualize usage statistics for your service.</div>
<div class="line">The module relies on several open source solutions that allow for data persistence and visualization</div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://clickhouse.com/">Clickhouse</a> serves as an OLAP storage for data.</p></li>
<li><p>Batching and preprocessing data is based on <a class="reference external" href="https://opentelemetry.io/docs/what-is-opentelemetry/">OpenTelemetry protocol</a> and the <a class="reference external" href="https://opentelemetry.io/docs/collector/">OpenTelemetry collector</a>.</p></li>
<li><p>Interactive visualization is powered by <a class="reference external" href="https://superset.apache.org/">Apache Superset</a>.</p></li>
</ul>
<p>All the mentioned services are shipped as Docker containers, including a pre-built Superset image that ensures API compatibility.</p>
</section>
<section id="collection-procedure">
<h2>Collection procedure<a class="headerlink" href="#collection-procedure" title="Permalink to this heading">¶</a></h2>
<p><strong>Installation</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># clone the original repository to access the docker compose file</span>
<span class="linenos">2</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/deeppavlov/dialog_flow_framework.git
<span class="linenos">3</span><span class="c1"># install with the stats extra</span>
<span class="linenos">4</span><span class="nb">cd</span><span class="w"> </span>dialog_flow_framework
<span class="linenos">5</span>pip<span class="w"> </span>install<span class="w"> </span>.<span class="o">[</span>stats<span class="o">]</span>
</pre></div>
</div>
<p><strong>Launching services</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># clone the original repository to access the docker compose file</span>
<span class="linenos">2</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/deeppavlov/dialog_flow_framework.git
<span class="linenos">3</span><span class="c1"># launch the required services</span>
<span class="linenos">4</span><span class="nb">cd</span><span class="w"> </span>dialog_flow_framework
<span class="linenos">5</span>docker<span class="w"> </span>compose<span class="w"> </span>--profile<span class="w"> </span>stats<span class="w"> </span>up
</pre></div>
</div>
<p><strong>Collecting data</strong></p>
<p>Collecting data is done by means of instrumenting your conversational service before you run it.
DFF tutorials (<a class="reference external" href="../tutorials/tutorials.stats.1_extractor_functions.py">1</a>, <a class="reference external" href="../tutorials/tutorials.stats.2_pipeline_integration.py">2</a>)
showcase all the steps needed to achieve that. We will run
a special script in order to obtain richly-annotated sample data points to visualize.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>utils/stats/sample_data_provider.py
</pre></div>
</div>
</section>
<section id="displaying-the-data">
<h2>Displaying the data<a class="headerlink" href="#displaying-the-data" title="Permalink to this heading">¶</a></h2>
<p>In order to display the Superset dashboard, you should update the default configuration with the credentials of your database.
The configuration can be optionally saved as a zip archive for inspection / debug.</p>
<p>You can set most of the configuration options using a YAML file.
The default example file can be found in the <cite>tutorials/stats</cite> directory:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># tutorials/stats/example_config.yaml</span>
<span class="linenos">2</span><span class="nt">db</span><span class="p">:</span>
<span class="linenos">3</span><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clickhousedb+connect</span>
<span class="linenos">4</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="linenos">5</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<span class="linenos">6</span><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clickhouse</span>
<span class="linenos">7</span><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8123</span>
<span class="linenos">8</span><span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel_logs</span>
</pre></div>
</div>
<p>The file can then be used to parametrize the configuration script.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dff.stats<span class="w"> </span>tutorials/stats/example_config.yaml<span class="w"> </span>-P<span class="w"> </span>superset<span class="w"> </span>-dP<span class="w"> </span>pass<span class="w"> </span>-U<span class="w"> </span>superset<span class="w"> </span>--outfile<span class="o">=</span>config_artifact.zip
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Here we passed passwords via CLI, which is not recommended. For enhanced security, call the command above omitting the passwords (<cite>dff.stats -P -dP -U superset …</cite>) and you will be prompted to enter them interactively.</p>
</div>
<p>Running the command will automatically import the dashboard as well as the data sources
into the running superset server. If you are using a version of Superset different from the one
shipped with DFF, make sure that your access rights are sufficient to edit the workspace.</p>
</section>
<section id="using-superset">
<h2>Using Superset<a class="headerlink" href="#using-superset" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">In order to view the imported dashboard, log into <a class="reference external" href="http://localhost:8088/">Superset</a> using your username and password (which are both <cite>superset</cite> by default and can be configured via <cite>.env_file</cite>).</div>
<div class="line">The dashboard will then be available in the <strong>Dashboards</strong> section of the Superset UI under the name of <strong>DFF stats</strong>.</div>
<div class="line">The dashboard is split into four sections based on the types of charts and on the chart topic.</div>
</div>
<ul class="simple">
<li><p>The <strong>Overview</strong> section summarizes the information about user interaction with your script. And displays a weighted graph of transitions from one node to another. The data is also shown in the form of a table for better introspection capabilities.</p></li>
</ul>
<figure class="align-default" id="id3">
<img alt="../_images/overview.png" src="../_images/overview.png" />
<figcaption>
<p><span class="caption-text">Overview plots.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>The data displayed in the <strong>Node stats</strong> section reports, how frequent each of the nodes in your script was visited by users. The information is aggregated in several forms for better interpretability.</p></li>
</ul>
<figure class="align-default" id="id4">
<img alt="../_images/general_stats.png" src="../_images/general_stats.png" />
<figcaption>
<p><span class="caption-text">Node stats plots.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>General service load data aggregated over time can be found in the <strong>Service stats</strong> section.</p></li>
</ul>
<figure class="align-default" id="id5">
<img alt="../_images/service_stats.png" src="../_images/service_stats.png" />
<figcaption>
<p><span class="caption-text">Service stats plots.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>The <strong>Annotations</strong> section contains example charts that show how annotations from supplemental pipeline services can be viewed and analyzed.</p></li>
</ul>
<figure class="align-default" id="id6">
<img alt="../_images/annotations.png" src="../_images/annotations.png" />
<figcaption>
<p><span class="caption-text">Plots for pipeline-produced dialog annotations.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>On some occasions, Superset can show warnings about the database connection being faulty.
In that case, you can navigate to the <cite>Database Connections</cite> section through the <cite>Settings</cite> menu and edit the <cite>dff_database</cite> instance updating the credentials.</p>
<figure class="align-default" id="id7">
<img alt="../_images/databases.png" src="../_images/databases.png" />
<figcaption>
<p><span class="caption-text">Locate the database settings in the right corner of the screen.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="customizing-the-dashboard">
<h2>Customizing the dashboard<a class="headerlink" href="#customizing-the-dashboard" title="Permalink to this heading">¶</a></h2>
<p>The most notable advantage of using Superset as a visualization tool is that it provides
an easy and intuitive way to create your own charts and to customize the dashboard.</p>
<p><strong>Datasets</strong></p>
<p>If you aim to create your own chart, Superset will prompt you to select a dataset to draw data from.
The current configuration provides three datasets <cite>dff-node-stats</cite>, <cite>dff-stats</cite>, and <cite>dff-final-nodes</cite>.
However, in most cases, you would use <cite>dff-stats</cite> or <cite>dff-node-stats</cite>. The former contains all data points,
while the latter only includes the logs produced by <cite>get_current_label</cite> extractor
(<a class="reference external" href="../apiref/dff.stats.default_extractors.html#dff.stats.default_extractors.get_current_label">see the API reference</a>).
<cite>dff-final-nodes</cite> contains the same information as the said datasources,
but only aggregates the labels of nodes visited at the end of dialog graph traversal,
i.e. nodes that terminate the dialog.</p>
<p><cite>dff-nodes-stats</cite> uses the following variables to store the data:</p>
<ul class="simple">
<li><p>The <cite>context_id</cite> field can be used to distinguish dialog contexts from each other and serves as a user identifier.</p></li>
<li><p><cite>request_id</cite> is the number of the dialog turn at which the data record was emitted. The data points can be aggregated over this field, showing the distribution of a variable over the dialog history.</p></li>
<li><p>The <cite>data_key</cite> field contains the name of the extractor function that emitted the given record. Since in most cases you will only need the output of one extractor, you can filter out all the other records using filters.</p></li>
<li><p>Finally, the <cite>data</cite> field is a set of JSON-encoded key-value pairs. The keys and values differ depending on the extractor function that emitted the data (you can essentially save arbitrary data under arbitrary keys), which makes filtering the data rows by their <cite>data_key</cite> all the more important. The JSON format implies that individual values need to be extracted using the Superset SQL functions (see below).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JSON_VALUE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;$.key&#39;</span><span class="p">)</span>
<span class="n">JSON_VALUE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;$.outer_key.nested_key&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Chart creation</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Chart creation is described in detail in the official Superset documentation.
We suggest that you consult it in addition to this section:
<a class="reference external" href="https://superset.apache.org/docs/creating-charts-dashboards/exploring-data/#pivot-table">link</a>.</p>
</div>
<p>Creating your own chart is as easy as navigating to the <cite>Charts</cite> section of the Superset app
and pressing the <cite>Create</cite> button.</p>
<p>Initially, you will be prompted for the dataset that you want to use as well as for the chart type.
The Superset GUI provides comprehensive previews of each chart type making it very easy
to find the exact kind that you need.</p>
<p>At the next step, you will be redirected to the chart creation interface.
Depending on the kind of chat that you have chosen previously, menus will be available
to choose a column for the x-axis and, optionally, a column for the y-axis. As mentioned above,
a separate menu for data filters will also be available. If you need to use the data
from the <cite>data</cite> column, you will need to find the <cite>custom_sql</cite> option when adding the column
and put in the extraction expression, as shown in the examples above.</p>
<p><strong>Exporting the chart configuration</strong></p>
<p>The configuration of a Superset dashboard can be easily exported and then reused
in other Superset instances. This can be done using the GUI: navigate to the
<cite>Dashboards</cite> section of the Superset application, locate your dashboard (named <cite>DFF statistics</cite> per default).
Then press the <cite>export</cite> button on the right and save the zip file to any convenient location.</p>
<p><strong>Importing existing configuration files</strong></p>
<p>If you need to restore your dashboard or update the configuration, you can import a configuration archive
that has been saved in the manner described below.</p>
<p>Log in to Superset, open the <cite>Dashboards</cite> tab and press the import button on the right of the screen.
You will be prompted for the database password. If the database credentials match,
the updated dashboard will appear in the dashboard list.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Python</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guides.html">User guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_us.html">About us</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../user_guides.html">User guides</a><ul>
      <li>Previous: <a href="context_guide.html" title="previous chapter">Context guide</a></li>
      <li>Next: <a href="optimization_guide.html" title="next chapter">Optimization Guide</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/user_guides/superset_guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>